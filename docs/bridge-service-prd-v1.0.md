# PRDï¼šSWE-Agent æ¡¥æ¥æœåŠ¡

- **ç‰ˆæœ¬**ï¼š1.0
- **çŠ¶æ€**ï¼šActive
- **Owner**ï¼šSWE-Agent Team
- **æ›´æ–°æ—¥æœŸ**ï¼š2025-10-18

---

## ğŸ“Œ äº§å“å®šä½

### æ ¸å¿ƒå®šä½

SWE-Agent æ˜¯ä¸€ä¸ª **GitHub â†” Claude Code/Codex æ¡¥æ¥æœåŠ¡**ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ AI Agentã€‚

```
ç”¨æˆ·åœ¨ GitHub Issue/PR è¯„è®º `/code xxx`
         â†“
    SWE-Agentï¼ˆæ¡¥æ¥å±‚ï¼‰
         â†“
   Claude Code / Codex CLIï¼ˆAI å¤„ç†å±‚ï¼‰
         â†“
    SWE-Agentï¼ˆä»“åº“æ“ä½œå±‚ï¼‰
         â†“
   æ¨é€ä»£ç  + ç”Ÿæˆ PR é“¾æ¥
```

### è®¾è®¡å“²å­¦

**æˆ‘ä»¬åšä»€ä¹ˆ**ï¼š
- âœ… ç›‘å¬ GitHub Webhook
- âœ… èšåˆä¸Šä¸‹æ–‡ï¼ˆIssue/PR å†å²ï¼‰ä¼ é€’ç»™ AI CLI
- âœ… è°ƒç”¨ `codex` / `claude` å‘½ä»¤ï¼ˆCLI ç›´é€šï¼‰
- âœ… æ£€æµ‹æ–‡ä»¶å˜æ›´ã€æäº¤ã€æ¨é€åˆ†æ”¯
- âœ… ç”Ÿæˆ PR compare é“¾æ¥ï¼Œäººå·¥ç¡®è®¤ååˆ›å»º PR
- âœ… å®æ—¶æ›´æ–° GitHub Comment è¿›åº¦

**æˆ‘ä»¬ä¸åšä»€ä¹ˆ**ï¼š
- âŒ ä¸å®ç° AI èƒ½åŠ›ï¼ˆæ‰€æœ‰æ™ºèƒ½é€»è¾‘ç”± Claude Code/Codex å¤„ç†ï¼‰
- âŒ ä¸ç®¡ç†å¤æ‚å·¥ä½œæµï¼ˆæ²¡æœ‰ `/clarify`ã€`/prd`ã€`/code-review` ç­‰å¤šé˜¶æ®µå‘½ä»¤ï¼‰
- âŒ ä¸åš Prompt å·¥ç¨‹ï¼ˆç›´æ¥ä¼ é€’ç”¨æˆ·æŒ‡ä»¤å’Œä¸Šä¸‹æ–‡ï¼‰
- âŒ ä¸è‡ªåŠ¨åˆ›å»º PRï¼ˆç”Ÿæˆ compare é“¾æ¥ï¼Œç”¨æˆ·ç¡®è®¤ï¼‰

**ç”± Claude Code/Codex è´Ÿè´£**ï¼š
- âœ… éœ€æ±‚æ¾„æ¸…ï¼ˆAI ä¼šä¸»åŠ¨æé—®ï¼‰
- âœ… ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆAI è‡ªå·±å†³å®šæ˜¯å¦ lint/testï¼‰
- âœ… å¤šè½®å¯¹è¯ä¸ä¸Šä¸‹æ–‡ç†è§£
- âœ… ä»£ç å®¡æŸ¥ä¸é‡æ„å»ºè®®
- âœ… æ–‡æ¡£æ›´æ–°ä¸ PR æè¿°ç”Ÿæˆ

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. Webhook å¤„ç†å±‚

**åŠŸèƒ½**ï¼š
- ç›‘å¬ GitHub `issue_comment`ã€`pull_request_review_comment` äº‹ä»¶
- HMAC SHA-256 ç­¾åéªŒè¯
- è§£æè§¦å‘è¯ï¼ˆé»˜è®¤ `/code`ï¼Œå¯é…ç½®ï¼‰
- æƒé™æ§åˆ¶ï¼ˆé»˜è®¤ä»… GitHub App Installerï¼‰
- é˜²æŠ–æœºåˆ¶ï¼ˆBot è¯„è®ºè¿‡æ»¤ã€12h å»é‡ï¼‰

**å…³é”®å®ç°**ï¼š
- `internal/webhook/handler.go` - Webhook äº‹ä»¶å¤„ç†
- `internal/webhook/verify.go` - ç­¾åéªŒè¯
- `internal/auth/permission.go` - æƒé™æ£€æŸ¥

### 2. AI é›†æˆå±‚

**åŠŸèƒ½**ï¼š
- æ”¯æŒå¤š Providerï¼ˆCodex / Claude Code CLIï¼‰
- ä¸Šä¸‹æ–‡èšåˆï¼ˆIssue æ ‡é¢˜ + æ­£æ–‡ + è¯„è®ºå†å²ï¼‰
- CLI å‚æ•°æ„å»ºä¸è°ƒç”¨
- Streaming è¾“å‡ºæ•è·ï¼ˆå®æ—¶åŒæ­¥åˆ° GitHub Commentï¼‰

**å…³é”®å®ç°**ï¼š
- `internal/provider/codex/codex.go` - Codex CLI è°ƒç”¨
- `internal/provider/claude/claude.go` - Claude Code CLI è°ƒç”¨
- `internal/executor/task.go` - ä¸Šä¸‹æ–‡ç»„è£…

**Prompt ç­–ç•¥**ï¼š
```go
// æç®€ Promptï¼Œç›´æ¥ä¼ é€’ç”¨æˆ·æŒ‡ä»¤å’Œä¸Šä¸‹æ–‡
func buildPrompt(task *Task) string {
    return fmt.Sprintf(`
Repository: %s
Issue #%d: %s

%s

User Request:
%s

Please implement the requested changes.
`, task.Repo, task.Number, task.IssueTitle, task.IssueContext, task.Prompt)
}
```

### 3. ä»“åº“æ“ä½œå±‚

**åŠŸèƒ½**ï¼š
- å…‹éš†ä»“åº“åˆ°ä¸´æ—¶ç›®å½•
- æ–‡ä»¶å˜æ›´æ£€æµ‹ï¼ˆ`git status`ï¼‰
- åˆ†æ”¯ç®¡ç†ï¼ˆåˆ›å»º / å¤ç”¨ç°æœ‰ PR åˆ†æ”¯ï¼‰
- æäº¤å¹¶æ¨é€åˆ° GitHub
- ç”Ÿæˆ PR compare é“¾æ¥ï¼ˆé¢„å¡« title å’Œ `Fixes #<number>`ï¼‰

**å…³é”®å®ç°**ï¼š
- `internal/github/clone.go` - ä»“åº“å…‹éš†
- `internal/executor/task.go` - æ–‡ä»¶å˜æ›´æ£€æµ‹
- `internal/github/pr.go` - PR é“¾æ¥ç”Ÿæˆ

### 4. ä»»åŠ¡é˜Ÿåˆ—ä¸å¯é æ€§å±‚

**åŠŸèƒ½**ï¼š
- æœ‰ç•Œä»»åŠ¡é˜Ÿåˆ—ï¼ˆå†…å­˜å®ç°ï¼‰
- å·¥ä½œæ± å¹¶å‘æ§åˆ¶ï¼ˆé»˜è®¤ 4 workersï¼‰
- æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- PR/Issue ä¸²è¡Œæ‰§è¡Œï¼ˆé¿å…å†²çªï¼‰
- è¶…æ—¶ä¿æŠ¤ï¼ˆ10 åˆ†é’Ÿï¼‰

**å…³é”®å®ç°**ï¼š
- `internal/dispatcher/dispatcher.go` - ä»»åŠ¡è°ƒåº¦
- `internal/taskstore/store.go` - ä»»åŠ¡å­˜å‚¨

### 5. è¿›åº¦è¿½è¸ªä¸åé¦ˆå±‚

**åŠŸèƒ½**ï¼š
- è¯„è®ºçŠ¶æ€ç®¡ç†ï¼ˆQueued â†’ Working â†’ Completed/Failedï¼‰
- å®æ—¶è¿›åº¦æ›´æ–°ï¼ˆStreaming è¾“å‡ºåŒæ­¥ï¼‰
- é”™è¯¯ä¿¡æ¯åé¦ˆï¼ˆå¤±è´¥æ—¶è¯„è®ºé”™è¯¯è¯¦æƒ…ï¼‰
- æˆæœ¬è¿½è¸ªï¼ˆå¯é€‰ï¼‰

**å…³é”®å®ç°**ï¼š
- `internal/github/comment_tracker.go` - è¯„è®ºè¿½è¸ª
- `internal/github/comment_state.go` - çŠ¶æ€æšä¸¾

---

## ğŸš« æ˜ç¡®ä¸åšçš„åŠŸèƒ½

### 1. å¤šé˜¶æ®µå·¥ä½œæµ

**ä¸å®ç°**ï¼š
- `/clarify` - éœ€æ±‚æ¾„æ¸…é˜¶æ®µ
- `/prd` - PRD ç”Ÿæˆé˜¶æ®µ
- `/code-review` - ä»£ç å®¡æŸ¥é˜¶æ®µ

**åŸå› **ï¼š
- è¿™äº›æ˜¯ AI çš„èƒ½åŠ›ï¼Œåº”ç”± Claude Code/Codex è‡ªå·±å¤„ç†
- å¢åŠ äº†ä¸å¿…è¦çš„å¤æ‚åº¦
- ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨å¯¹è¯ä¸­è¦æ±‚ AI åšè¿™äº›äº‹æƒ…

### 2. Prompt æ¨¡æ¿ç®¡ç†

**ä¸å®ç°**ï¼š
- å¤æ‚çš„ Prompt æ¨¡æ¿ç³»ç»Ÿ
- Prompt ä¼˜åŒ–ä¸è°ƒè¯•

**åŸå› **ï¼š
- Codex/Claude Code å·²ç»æœ‰å®Œå–„çš„ Prompt å¤„ç†èƒ½åŠ›
- ç›´æ¥ä¼ é€’ç”¨æˆ·æŒ‡ä»¤æ›´çµæ´»

### 3. WorkflowState çŠ¶æ€æœº

**ä¸å®ç°**ï¼š
- Stage 0-5 çš„å¤æ‚çŠ¶æ€è¿½è¸ª
- Clarificationsã€PRDã€FixAttempts ç­‰å­—æ®µ

**åŸå› **ï¼š
- ç®€åŒ–ä¸ºå•ä¸€ Task æ¨¡å‹
- çŠ¶æ€ç”± Comment å’Œ Git å†å²è¿½æº¯

### 4. è·¨ä»“åº“åä½œï¼ˆMulti-Repoï¼‰

**ä¸å®ç°**ï¼ˆè‡³å°‘ v1.0 ä¹‹å‰ï¼‰ï¼š
- è·¨ä»“åº“ä»»åŠ¡æ‹†åˆ†ä¸æ‰§è¡Œ
- å¤æ‚çš„ä¾èµ–é¡ºåºæ§åˆ¶

**åŸå› **ï¼š
- è¿‡äºå¤æ‚ï¼Œé£é™©é«˜
- å¯ä»¥é€šè¿‡å¤šæ¬¡ `/code` æ‰‹åŠ¨å¤„ç†

---

## ğŸ“… è·¯çº¿å›¾

### v0.5 - æ¡¥æ¥æœåŠ¡ä¼˜åŒ–ï¼ˆğŸ”„ è¿›è¡Œä¸­ï¼‰

**æ ¸å¿ƒç›®æ ‡**ï¼šå¼ºåŒ–æ¡¥æ¥æœåŠ¡çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ

- [ ] **Streaming è¾“å‡ºåŒæ­¥** - CLI å®æ—¶è¾“å‡ºåŒæ­¥åˆ° GitHub Comment
- [ ] **æ”¹è¿›è¯„è®ºæ ¼å¼** - æ›´æ¸…æ™°çš„ä»»åŠ¡çŠ¶æ€å±•ç¤º
- [ ] **æˆæœ¬è¿½è¸ª** - ç»Ÿè®¡ API è°ƒç”¨æˆæœ¬å’Œé…é¢
- [ ] **é™æµä¿æŠ¤** - é˜²æ­¢æ»¥ç”¨ï¼ˆæŒ‰ä»“åº“/å°æ—¶é™é¢ï¼‰

**å·¥ä½œé‡ä¼°ç®—**ï¼š2-3 å‘¨

### v0.6 - å¯é æ€§å¢å¼ºï¼ˆğŸ“… è®¡åˆ’ä¸­ï¼‰

**æ ¸å¿ƒç›®æ ‡**ï¼šæå‡æœåŠ¡çš„ç”Ÿäº§å¯ç”¨æ€§

- [ ] **é˜Ÿåˆ—æŒä¹…åŒ–** - Redis/æ•°æ®åº“å®ç°ä»»åŠ¡æŒä¹…æ€§
- [ ] **ä»»åŠ¡å†å²** - è¿½è¸ªæ‰§è¡Œå†å²å¹¶ä»æ–­ç‚¹æ¢å¤
- [ ] **Web UI** - ä»»åŠ¡ç›‘æ§ä¸é…ç½®ç®¡ç†
- [ ] **ç»“æ„åŒ–æ—¥å¿—** - JSON æ—¥å¿— + æ—¥å¿—ç­‰çº§

**å·¥ä½œé‡ä¼°ç®—**ï¼š3-4 å‘¨

### v1.0 - ä¼ä¸šçº§ç‰¹æ€§ï¼ˆğŸ¯ é•¿æœŸç›®æ ‡ï¼‰

**æ ¸å¿ƒç›®æ ‡**ï¼šæ»¡è¶³ä¼ä¸šåœºæ™¯çš„æ²»ç†éœ€æ±‚

- [ ] **å›¢é˜Ÿæƒé™ç®¡ç†** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- [ ] **æˆæœ¬æ§åˆ¶ä¸­å¿ƒ** - API å¼€é”€é¢„ç®—ä¸å‘Šè­¦
- [ ] **å®¡è®¡æ—¥å¿—** - è®°å½•æ‰€æœ‰æ“ä½œä»¥æ»¡è¶³åˆè§„
- [ ] **æ¨ªå‘æ‰©å±•** - å¤š worker èŠ‚ç‚¹æ”¯æŒ
- [ ] **é«˜çº§é™æµ** - ä»“åº“/ç»„ç»‡/ç”¨æˆ·ç²’åº¦

**å·¥ä½œé‡ä¼°ç®—**ï¼š1-2 ä¸ªæœˆ

---

## âœ… éªŒæ”¶æ ‡å‡†

### æ ¸å¿ƒç”¨æˆ·ä½“éªŒ

**ç”¨æˆ·åœ¨ GitHub Issue è¯„è®º**ï¼š
```
/code å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œæ”¯æŒé‚®ç®±å’Œå¯†ç ç™»å½•
```

**SWE-Agent åº”è¯¥**ï¼š
1. âœ… åœ¨ 1 åˆ†é’Ÿå†…å›å¤è¯„è®ºï¼Œæ˜¾ç¤º `â³ Working`
2. âœ… è°ƒç”¨ Claude Code/Codex CLI
3. âœ… å®æ—¶åŒæ­¥ AI è¾“å‡ºåˆ°è¯„è®ºï¼ˆå¦‚æœå®ç°äº† Streamingï¼‰
4. âœ… æ£€æµ‹æ–‡ä»¶å˜æ›´ï¼Œæäº¤åˆ°æ–°åˆ†æ”¯
5. âœ… åœ¨è¯„è®ºä¸­å›å¤ï¼š
   - ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨
   - PR compare é“¾æ¥ï¼ˆé¢„å¡« title å’Œ `Fixes #123`ï¼‰
   - æˆæœ¬ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
6. âœ… ç”¨æˆ·ç‚¹å‡»é“¾æ¥ï¼Œç¡®è®¤åæ‰‹åŠ¨åˆ›å»º PR

**ç”¨æˆ·åœ¨ PR è¯„è®ºä¸­ä¿®å¤**ï¼š
```
/code ä¿®å¤æµ‹è¯•å¤±è´¥çš„é—®é¢˜
```

**SWE-Agent åº”è¯¥**ï¼š
1. âœ… æ£€æµ‹åˆ°è¿™æ˜¯ PR è¯„è®º
2. âœ… åœ¨ç°æœ‰ PR åˆ†æ”¯ä¸Šè¿½åŠ æäº¤
3. âœ… ä¸åˆ›å»ºæ–° PR

### å¯é æ€§ä¸å®‰å…¨

- âœ… é Installer è§¦å‘æ—¶æ‹’ç»æ‰§è¡Œ
- âœ… Bot è¯„è®ºä¸è§¦å‘æ— é™å¾ªç¯
- âœ… åŒä¸€ Issue/PR ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œ
- âœ… 10 åˆ†é’Ÿè¶…æ—¶ä¿æŠ¤
- âœ… å¤±è´¥æ—¶åœ¨è¯„è®ºä¸­æ˜ç¡®æç¤ºé”™è¯¯åŸå› 

---

## ğŸ”’ å®‰å…¨è€ƒé‡

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Webhook ç­¾åæ ¡éªŒ | âœ… å·²å®ç° | HMAC SHA-256 |
| æ’å®šæ—¶é—´æ¯”è¾ƒ | âœ… å·²å®ç° | é˜²æ­¢è®¡æ—¶æ”»å‡» |
| å‘½ä»¤æ³¨å…¥é˜²æŠ¤ | âœ… å·²å®ç° | SafeCommandRunner |
| è¶…æ—¶ä¿æŠ¤ | âœ… å·²å®ç° | 10 åˆ†é’Ÿè¶…æ—¶ |
| Bot è¯„è®ºè¿‡æ»¤ | âœ… å·²å®ç° | é˜²æ­¢æ— é™å¾ªç¯ |
| æƒé™æ§åˆ¶ | âœ… å·²å®ç° | ä»… Installer å¯è§¦å‘ |
| API Key ç®¡ç† | âš ï¸ å»ºè®® | ä½¿ç”¨ç¯å¢ƒå˜é‡ |
| é˜Ÿåˆ—æŒä¹…åŒ– | âš ï¸ è§„åˆ’ä¸­ | v0.6 ç›®æ ‡ |
| é™æµ | âš ï¸ è§„åˆ’ä¸­ | v0.5 ç›®æ ‡ |

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### v0.5 ç›®æ ‡

- ç”¨æˆ·è§¦å‘ â†’ PR é“¾æ¥ç”Ÿæˆçš„æˆåŠŸç‡ > 90%
- å¹³å‡å“åº”æ—¶é—´ < 2 åˆ†é’Ÿ
- æœåŠ¡å¯ç”¨æ€§ > 99%
- ç”¨æˆ·æ‰‹åŠ¨åˆ›å»º PR çš„æ¯”ä¾‹ > 80%ï¼ˆè¯´æ˜æµç¨‹é¡ºç•…ï¼‰

### v1.0 ç›®æ ‡

- ä¼ä¸šçº§å®¢æˆ· > 10 å®¶
- æœˆæ´»è·ƒä»“åº“ > 100 ä¸ª
- ä»»åŠ¡é˜Ÿåˆ—æŒä¹…åŒ–ï¼Œ0 æ•°æ®ä¸¢å¤±
- æˆæœ¬å‘Šè­¦å‡†ç¡®æ€§ > 95%

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Claude Code CLI æ–‡æ¡£](https://github.com/anthropics/claude-code)
- [Codex CLI æ–‡æ¡£](https://github.com/codex-rs/codex)
- [GitHub App æƒé™é…ç½®](https://docs.github.com/en/apps)
- [Webhook ç­¾åéªŒè¯](https://docs.github.com/en/webhooks/using-webhooks/validating-webhook-deliveries)

---

## ğŸ”„ æ›´æ–°å†å²

- **2025-10-18**ï¼šv1.0 - åˆå§‹ç‰ˆæœ¬ï¼Œæ˜ç¡®æ¡¥æ¥æœåŠ¡å®šä½
- **å½’æ¡£**ï¼šauto-dev-pipeline-prd-v0.1.mdï¼ˆå¤æ‚çš„å¤šé˜¶æ®µå·¥ä½œæµæ–¹æ¡ˆï¼‰
